<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="qti2-controller" attributes="mode sessionVariableName">

<template></template> 

<script>
	Polymer('qti2-controller', {
		mode: 'js', // or 'ws' for web services
		sessionVariableName: null,
		_variable: null,

		ready : function() {
			this._variable = window[this.sessionVariableName]; // TODO: this sucks
			document.addEventListener('polymer-ready', this.bindInteractions.bind(this));
		},
		
		bindInteractions: function() {
			// join just to allow us to split them across lines
			var interactions = document.querySelectorAll(['qti2-choiceInteraction', 
			    'qti2-orderInteraction', 'qti2-associateInteraction', 'qti2-matchInteraction',
			    'qti2-gapMatchInteraction', 'qti2-inlineChoiceInteraction', 'qti2-textEntryInteraction', 
			    'qti2-extendedTextInteraction', 'qti2-hottextInteraction', 'qti2-graphicInteraction',
			    'qti2-hotspotInteraction', 'qti2-selectPointInteraction', 'qti2-graphicOrderInteraction',
			    'qti2-graphicAssociateInteraction', 'qti2-graphicGapMatchInteraction', 'qti2-positionObjectInteraction',
			    'qti2-sliderInteraction', 'qti2-mediaInteraction', 'qti2-drawingInteraction', 'qti2-uploadInteraction',
			    'qti2-customInteraction',
			    
			    'qti2-feedbackInline'
			    ].join(', '));

			for (var i in interactions) {
				var interaction = interactions[i];
				if (!typeof interaction == 'object') {
					return;
				}
				
				// Response variables
				var responseIdentifier = interaction.responseIdentifier;
				if (responseIdentifier in this._variable.response) {
					interaction._responseVariable = this._variable.response[responseIdentifier];
				} else {
					console.log("Variable not found " + responseIdentifier);
				}
				
				// Outcome variables
				var outcomeIdentifier = interaction.outcomeIdentifier;
				if (typeof outcomeIdentifier != 'undefined') {
					if (outcomeIdentifier in this._variable.outcome) {
						interaction._outcomeVariable = this._variable.outcome[outcomeIdentifier];
					}
				}
			}
		}
	});
</script> 

</polymer-element>